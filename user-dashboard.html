<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account - Alina Collection</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dashboard.css">
</head>
<body class="dashboard-body">
    <!-- Premium Navigation -->
    <section id="header">
      <a href="index.html"><img src="image/Logo/logo.png" class="logo" alt="Alina Collection"/></a>
      <div class="header-search">
        <input type="text" placeholder="Search premium fashion..." id="header-search-input">
        <button type="button" id="header-search-btn"><i class="fas fa-search"></i></button>
      </div>
      <div>
        <ul id="navbar">
          <li><a href="index.html">Home</a></li>
          <li>
            <a href="shop.html">Shop <i class="fas fa-angle-down"></i></a>
            <ul class="dropdown-menu">
                <li><a href="shop.html?cat=Tops">Tops & Shirts</a></li>
                <li><a href="shop.html?cat=Bottoms">Pants & Bottoms</a></li>
                <li><a href="shop.html?cat=Dresses">Dresses</a></li>
                <li><a href="shop.html?cat=Outerwear">Outerwear</a></li>
                <li><a href="shop.html?cat=Footwear">Footwear</a></li>
                <li><a href="shop.html?cat=Accessories">Accessories</a></li>
            </ul>
          </li>
          <li><a href="about.html">Our Story</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>
    </section>

    <div class="dashboard-container">
        <main class="main-content fade-in">
            
            <!-- 1. Profile Header (Welcome) -->
            <div class="profile-header-card">
                <div class="profile-bg-overlay"></div>
                <div class="profile-info-main">
                    <div class="avatar-container">
                        <div class="profile-avatar" id="avatar-preview">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <label for="profile-upload" class="avatar-edit-btn">
                            <i class="fa-solid fa-camera"></i>
                            <input type="file" id="profile-upload" accept="image/*" style="display: none;">
                        </label>
                    </div>
                    <div class="profile-text">
                        <h2 id="user-greeting-large">Hello, User!</h2>
                        <p id="user-email-small">user@example.com</p>
                        <span class="role-badge" id="user-role-badge"><i class="fa-solid fa-user"></i> User</span>
                    </div>
                </div>
                <div class="profile-stats-summary">
                    <div class="summary-item">
                        <span class="summary-value" id="count-orders">0</span>
                        <span class="summary-label">Orders</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value" id="count-wishlist">0</span>
                        <span class="summary-label">Wishlist</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value" id="count-spent">NPR 0</span>
                        <span class="summary-label">Total Spent</span>
                    </div>
                    <div class="summary-item premium-points">
                        <span class="summary-value" id="loyalty-points">0</span>
                        <span class="summary-label">Alina Points</span>
                    </div>
                </div>
            </div>

            <!-- Administrative Sovereign Suite (Visible only to David Scot) -->
            <div id="sovereign-suite" style="display: none; margin-bottom: 40px;">
                <div class="dash-card loyalty-card" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); margin-bottom: 30px;">
                    <div class="loyalty-content">
                        <div class="loyalty-icon"><i class="fas fa-shield-halved" style="color: var(--primary-color);"></i></div>
                        <div class="loyalty-text">
                            <h3>Administrative Overview</h3>
                            <p>Global system intelligence and sovereign control modules.</p>
                        </div>
                        <div class="stats-grid" style="display: flex; gap: 30px; margin: 0;">
                            <div class="stat-mini">
                                <span id="stat-total-sales" style="font-weight:800; color:var(--primary-color);">NPR 0</span>
                                <p style="font-size:10px; opacity:0.7;">Revenue</p>
                            </div>
                            <div class="stat-mini">
                                <span id="stat-low-stock" style="font-weight:800; color:#f59e0b;">0</span>
                                <p style="font-size:10px; opacity:0.7;">Low Stock</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sovereign Control Modules (Overview Grid) -->
                <div class="dashboard-grid-3">
                    <!-- Inventory Module -->
                    <div class="dash-card module-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-boxes-stacked"></i> Inventory Vault</h3>
                        </div>
                        <p style="font-size:13px; color:var(--dash-text-muted); margin: 15px 0;">Manage premium assets, refine configurations, and monitor reserves.</p>
                        <button onclick="window.location.href='admin-inventory.html'" class="normal" style="width:100%; border-radius:12px;">Manage Vault</button>
                    </div>

                    <!-- Fulfillment Module -->
                    <div class="dash-card module-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-receipt"></i> Order Fulfillment</h3>
                        </div>
                        <p style="font-size:13px; color:var(--dash-text-muted); margin: 15px 0;">Track transaction lifecycles, update fulfillment status, and audit history.</p>
                        <button onclick="window.location.href='admin-orders.html'" class="normal" style="width:100%; border-radius:12px;">Manage Orders</button>
                    </div>

                    <!-- Registry Module -->
                    <div class="dash-card module-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-user-shield"></i> Citizen Registry</h3>
                        </div>
                        <p style="font-size:13px; color:var(--dash-text-muted); margin: 15px 0;">Monitor member access, manage authorities, and review circle growth.</p>
                        <button onclick="window.location.href='admin-users.html'" class="normal" style="width:100%; border-radius:12px;">Manage Registry</button>
                    </div>
                </div>

                <div class="dashboard-grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- Quick Stats & Recent Activity -->
                    <div class="data-card dash-card">
                        <div class="card-header">
                            <h3><i class="fas fa-history"></i> Recent Transactions</h3>
                        </div>
                        <div class="table-responsive">
                            <table id="admin-recent-order-table">
                                <thead>
                                    <tr><th>Ref</th><th>Client</th><th>Value</th><th>Status</th></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Inventory Performance Mock -->
                    <div class="data-card dash-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> Inventory Velocity</h3>
                        </div>
                        <div class="inventory-performance-viz">
                            <div class="chart-mock">
                                <div class="bar" style="height: 80%;" data-label="Tops"></div>
                                <div class="bar" style="height: 45%;" data-label="Bottoms"></div>
                                <div class="bar" style="height: 95%;" data-label="Dresses"></div>
                                <div class="bar" style="height: 60%;" data-label="Heritage"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loyalty Program Section (Personal) -->
            <div class="dash-card loyalty-card fade-in">
                <div class="loyalty-content">
                    <div class="loyalty-icon"><i class="fas fa-crown"></i></div>
                    <div class="loyalty-text">
                        <h3>Alina Insider Rewards</h3>
                        <p>You're earning 1 point for every NPR 100 spent. Redeem points for exclusive discounts!</p>
                        <div class="progress-container">
                            <div class="progress-bar" id="points-progress" style="width: 0%;"></div>
                        </div>
                        <span id="points-needed">Spend NPR 500 more to reach Silver tier</span>
                    </div>
                    <button class="normal gold-btn" onclick="showToast('Feature coming soon!!!')">Redeem Points</button>
                </div>
            </div>

            <!-- Purchase History -->
            <div id="orders-section" class="section-wrapper">
                <div class="dash-card">
                    <div class="dash-header-modern">
                        <h3><i class="fa-solid fa-clock-rotate-left"></i> Purchase History</h3>
                        <p>Track and manage your recent orders.</p>
                    </div>
                    <div class="table-responsive">
                        <table class="order-table-modern" id="user-order-table">
                            <thead><tr><th>Reference</th><th>Date</th><th>Products</th><th>Amount</th><th>Status</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Dashboard Overview Sections (My Cart, My Wishlist, Track Order) -->
            <div class="dashboard-grid-3">
                <div id="cart-section" class="section-wrapper-mini">
                    <div class="dash-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-cart-shopping"></i> My Cart</h3>
                            <a href="cart.html" class="view-link">View Full Cart</a>
                        </div>
                        <div class="mini-list" id="mini-cart-list"></div>
                    </div>
                </div>
                <div id="wishlist-section" class="section-wrapper-mini">
                    <div class="dash-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-heart"></i> My Wishlist</h3>
                            <a href="shop.html" class="view-link">Add More</a>
                        </div>
                        <div class="mini-list" id="mini-wishlist-list"></div>
                    </div>
                </div>
                <div id="track-section" class="section-wrapper-mini">
                    <div class="dash-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-truck-fast"></i> Track Order</h3>
                        </div>
                        <div class="track-box">
                            <p>Enter your Order ID to see real-time status.</p>
                            <div class="track-input-group">
                                <input type="text" id="track-id-input" placeholder="e.g. #1001">
                                <button onclick="trackOrder()"><i class="fa-solid fa-magnifying-glass"></i></button>
                            </div>
                            <div id="track-result" class="track-result"></div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Product Modal (Admin Only) -->
    <div id="product-modal" class="modal-overlay">
        <div class="modal-content admin-modal">
            <div class="modal-header"><h2>Product Configuration</h2><button class="close-modal" onclick="closeProductModal()">&times;</button></div>
            <form id="product-form" onsubmit="saveProduct(event)">
                <input type="hidden" id="edit-id">
                <div class="modal-body">
                    <div class="input-grid">
                        <div class="input-group"><label>Designation</label><input type="text" id="edit-name" required></div>
                        <div class="input-group"><label>House / Brand</label><input type="text" id="edit-brand" required></div>
                    </div>
                    <div class="input-grid">
                        <div class="input-group"><label>Price (NPR)</label><input type="number" id="edit-price" required></div>
                        <div class="input-group"><label>Reserves</label><input type="number" id="edit-stock" required></div>
                    </div>
                    <div class="input-group"><label>Category</label><select id="edit-cat"><option value="Tops">Tops</option><option value="Bottoms">Bottoms</option><option value="Dresses">Dresses</option><option value="Outerwear">Outerwear</option><option value="Footwear">Footwear</option><option value="Accessories">Accessories</option><option value="Nepali Heritage">Nepali Heritage</option></select></div>
                    <div class="input-group"><label>Imagery URL</label><input type="text" id="edit-image"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn-cancel" onclick="closeProductModal()">Discard</button><button type="submit" class="btn-confirm">Authorize Changes</button></div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
             const user = JSON.parse(localStorage.getItem('currentUser'));
             if (!user) { window.location.href = 'login.html'; return; }
             
             // SOVEREIGN ADMIN INTEGRATION
             if (user.role === 'admin') {
                 document.getElementById('sovereign-suite').style.display = 'block';
                 renderAdminDashboard();
             }

             // Initial greeting & UI
             document.getElementById('user-greeting-large').innerText = `Hello, ${user.name}!`;
             document.getElementById('user-email-small').innerText = user.email;
             const roleBadge = document.getElementById('user-role-badge');
             if (user.role === 'admin') {
                 roleBadge.innerHTML = `<i class="fa-solid fa-user-shield"></i> Sovereign Admin`;
                 roleBadge.className = 'role-badge role-admin';
             } else {
                 roleBadge.innerHTML = `<i class="fa-solid fa-user"></i> User`;
                 roleBadge.className = 'role-badge role-user';
             }

             if (user.profilePic) document.getElementById('avatar-preview').innerHTML = `<img src="${user.profilePic}" alt="Profile">`;
             
             // Fill form
             document.getElementById('set-name').value = user.name || "";
             document.getElementById('set-email').value = user.email || "";
             document.getElementById('set-phone').value = user.phone || "";
             document.getElementById('set-dob').value = user.dob || "";
             document.getElementById('set-gender').value = user.gender || "";
             document.getElementById('set-house').value = user.house || "";
             document.getElementById('set-address').value = user.address || "";
             document.getElementById('set-city').value = user.city || "";
             document.getElementById('set-province').value = user.province || "";
             document.getElementById('set-country').value = user.country || "Nepal";

             // Form Submission
             document.getElementById('profile-form').addEventListener('submit', (e) => {
                 e.preventDefault();
                 const updatedUser = { ...user, 
                    name: document.getElementById('set-name').value, 
                    phone: document.getElementById('set-phone').value,
                    dob: document.getElementById('set-dob').value,
                    gender: document.getElementById('set-gender').value,
                    house: document.getElementById('set-house').value,
                    address: document.getElementById('set-address').value,
                    city: document.getElementById('set-city').value,
                    province: document.getElementById('set-province').value,
                    country: document.getElementById('set-country').value
                 };
                 localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                 let allUsers = JSON.parse(localStorage.getItem('users')) || [];
                 const uIdx = allUsers.findIndex(u => u.email === updatedUser.email);
                 if (uIdx !== -1) { allUsers[uIdx] = updatedUser; localStorage.setItem('users', JSON.stringify(allUsers)); }
                 showToast('Configuration Saved');
                 document.getElementById('user-greeting-large').innerText = `Hello, ${updatedUser.name}!`;
             });

             // Avatar Upload
             document.getElementById('profile-upload').addEventListener('change', function(e) {
                 const file = e.target.files[0];
                 if (file) {
                     const reader = new FileReader();
                     reader.onload = function(event) {
                         const dataUrl = event.target.result;
                         document.getElementById('avatar-preview').innerHTML = `<img src="${dataUrl}">`;
                         const cUser = JSON.parse(localStorage.getItem('currentUser'));
                         cUser.profilePic = dataUrl;
                         localStorage.setItem('currentUser', JSON.stringify(cUser));
                         let aUsers = JSON.parse(localStorage.getItem('users')) || [];
                         const idx = aUsers.findIndex(u => u.email === cUser.email);
                         if (idx !== -1) { aUsers[idx].profilePic = dataUrl; localStorage.setItem('users', JSON.stringify(aUsers)); }
                         showToast('Avatar Updated');
                     };
                     reader.readAsDataURL(file);
                 }
             });

             renderUserOrders(user.email);
             renderDashboardCart();
             renderDashboardWishlist();
             
             // Update Stats
             const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
             const userOrders = allOrders.filter(o => o.userEmail === user.email);
             const wishlistCount = JSON.parse(localStorage.getItem('wishlist'))?.length || 0;
             const totalSpent = userOrders.reduce((sum, o) => sum + o.total, 0);
             document.getElementById('count-orders').innerText = userOrders.length;
             document.getElementById('count-wishlist').innerText = wishlistCount;
             document.getElementById('count-spent').innerText = `NPR ${totalSpent}`;
             const points = Math.floor(totalSpent / 100);
             document.getElementById('loyalty-points').innerText = points;
                                       document.getElementById('points-progress').style.width = ((points % 500) / 5) + "%";
                                       document.getElementById('points-needed').innerText = `Earn ${500 - (points % 500)} more points for next tier!`;      
                                  });
                          
                                  function renderDashboardCart() {
                                      const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
                                      const container = document.getElementById('mini-cart-list');
                                      if (!container) return;
                          
                                      if (cartItems.length === 0) {
                                          container.innerHTML = '<p style="padding: 10px; color: #999; font-size: 13px;">Your cart is empty.</p>';
                                          return;
                                      }
                          
                                      container.innerHTML = cartItems.slice(0, 3).map(item => `
                                          <div class="mini-item">
                                              <img src="${item.image || 'image/product/f1.jpg'}" alt="${item.name}" onerror="this.onerror=null;this.src='image/product/f1.jpg';">
                                              <div class="mini-item-info">
                                                  <h4>${item.name}</h4>
                                                  <p>${item.quantity} x NPR ${item.price}</p>
                                              </div>
                                          </div>
                                      `).join('');
                                      if (cartItems.length > 3) {
                                          container.innerHTML += `<p style="font-size: 11px; margin-top: 10px; color: var(--primary-color);">+ ${cartItems.length - 3} more items</p>`;
                                      }
                                  }
                          
                                  function renderDashboardWishlist() {
                                      const wishlistIds = JSON.parse(localStorage.getItem('wishlist')) || [];
                                      const container = document.getElementById('mini-wishlist-list');
                                      if (!container) return;
                          
                                      if (wishlistIds.length === 0) {
                                          container.innerHTML = '<p style="padding: 10px; color: #999; font-size: 13px;">Your wishlist is empty.</p>';
                                          return;
                                      }
                          
                                      const allProducts = JSON.parse(localStorage.getItem('products')) || [];
                                      const wishlistItems = wishlistIds.map(id => allProducts.find(p => p.id === id)).filter(p => p);
                          
                                      container.innerHTML = wishlistItems.slice(0, 3).map(item => `
                                          <div class="mini-item">
                                              <img src="${item.image || 'image/product/f1.jpg'}" alt="${item.name}" onerror="this.onerror=null;this.src='image/product/f1.jpg';">
                                              <div class="mini-item-info">
                                                  <h4>${item.name}</h4>
                                                  <p>${item.brand}</p>
                                              </div>
                                          </div>
                                      `).join('');
                                      if (wishlistItems.length > 3) {
                                          container.innerHTML += `<p style="font-size: 11px; margin-top: 10px; color: var(--primary-color);">+ ${wishlistItems.length - 3} more items</p>`;
                                      }
                                  }
                          
                                  function trackOrder() {
                                      const trackId = document.getElementById('track-id-input').value.trim().replace('#', '');
                                      const resultArea = document.getElementById('track-result');
                                      const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
                                      const order = allOrders.find(o => o.id.toString() === trackId);
                          
                                      if (!order) {
                                          resultArea.innerHTML = '<p style="color: #ef4444; font-size: 13px; margin-top: 15px;">Order ID not found.</p>';
                                          return;
                                      }
                          
                                      const steps = ['placed', 'shipped', 'completed'];
                                      const currentIdx = steps.indexOf(order.status.toLowerCase());
                          
                                      resultArea.innerHTML = `
                                          <div class="tracking-visual">
                                              <div class="track-step ${currentIdx >= 0 ? 'active' : ''}">Placed</div>
                                              <div class="track-step ${currentIdx >= 1 ? 'active' : ''}">Shipped</div>
                                              <div class="track-step ${currentIdx >= 2 ? 'active' : ''}">Delivered</div>
                                          </div>
                                          <p style="font-size: 13px; margin-top: 15px; font-weight: 600;">Status: ${order.status.toUpperCase()}</p>
                                      `;
                                  }
                          
                                  function renderUserOrders(userEmail) {
                                      const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
                                      const userOrders = allOrders.filter(o => o.userEmail === userEmail);
                                      const tableBody = document.querySelector('#user-order-table tbody');
                          
                                      if (userOrders.length === 0) {
                                          if (tableBody) tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 40px; color: #999;">You haven\'t placed any orders yet.</td></tr>';
                                          return;
                                      }
                          
                                      tableBody.innerHTML = userOrders.map(o => `
                                          <tr>
                                              <td><strong>#${o.id}</strong></td>
                                              <td>${o.date}</td>
                                              <td>${o.items.length} Product(s)</td>
                                              <td><span class="price-text">NPR ${o.total}</span></td>
                                              <td><span class="status-badge status-${o.status}">${o.status}</span></td>
                                          </tr>
                                      `).join('');
                                  }
                              </script>             </body>
             </html>