<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>My Account - Alina Collection</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="responsiveHome.css">

</head>

<body class="dashboard-body">
    <!-- Premium Navigation -->
    <section id="header"></section>




    <div class="dashboard-container">
        <main class="main-content fade-in">

            <!-- 1. Profile Header (Welcome) -->
            <div class="profile-header-card">
                <div class="profile-bg-overlay"></div>
                <div class="profile-info-main">
                    <div class="avatar-container">
                        <div class="profile-avatar" id="avatar-preview">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <label for="profile-upload" class="avatar-edit-btn">
                            <i class="fa-solid fa-camera"></i>
                            <input type="file" id="profile-upload" accept="image/*" style="display: none;">
                        </label>
                    </div>
                    <div class="profile-text">
                        <h2 id="user-greeting-large">Hello, User!</h2>
                        <p id="user-email-small">user@example.com</p>
                        <span class="role-badge" id="user-role-badge"><i class="fa-solid fa-user"></i> User</span>
                    </div>
                </div>
                <div class="profile-stats-summary">
                    <div class="summary-item">
                        <span class="summary-value" id="count-orders">0</span>
                        <span class="summary-label">Orders</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value" id="count-wishlist">0</span>
                        <span class="summary-label">Wishlist</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value" id="count-spent">NPR 0</span>
                        <span class="summary-label">Total Spent</span>
                    </div>
                    <div class="summary-item premium-points">
                        <span class="summary-value" id="loyalty-points">0</span>
                        <span class="summary-label">Alina Points</span>
                    </div>
                </div>
            </div>

            <!-- Administrative Sovereign Suite (Visible only to David Scot) -->
            <div id="sovereign-suite" style="display: none; margin-bottom: 40px;">
                <div class="dash-card admin-control-panel">
                    <div class="loyalty-content">
                        <div class="admin-icon">
                            <i class="fas fa-shield-halved"></i>
                        </div>
                        <div class="loyalty-text">
                            <h3>Admin Control Panel</h3>
                            <p>Quick links to manage your shop's inventory, orders, and users.</p>
                        </div>
                        <div class="admin-stats-grid">
                            <div class="stat-mini">
                                <span id="stat-total-sales">NPR 0</span>
                                <p>Total Sales</p>
                            </div>
                            <div class="stat-mini">
                                <span id="stat-low-stock">0</span>
                                <p>Low Stock</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sovereign Control Modules (Overview Grid) -->
                <div class="dashboard-grid-3">
                    <!-- Inventory Module -->
                    <div class="dash-card module-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-boxes-stacked"></i> Products</h3>
                        </div>
                        <p style="font-size:13px; color:var(--dash-text-muted); margin: 15px 0;">Add new clothes, change
                            prices, and check how many items are left in stock.</p>
                        <button onclick="window.location.href='admin-inventory.html'" class="normal"
                            style="width:100%; border-radius:12px;">Manage Products</button>
                    </div>

                    <!-- Fulfillment Module -->
                    <div class="dash-card module-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-receipt"></i> Orders</h3>
                        </div>
                        <p style="font-size:13px; color:var(--dash-text-muted); margin: 15px 0;">Track all customer
                            purchases and update shipping or delivery status.</p>
                        <button onclick="window.location.href='admin-orders.html'" class="normal"
                            style="width:100%; border-radius:12px;">Manage Orders</button>
                    </div>

                    <!-- Registry Module -->
                    <div class="dash-card module-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-user-shield"></i> Users</h3>
                        </div>
                        <p style="font-size:13px; color:var(--dash-text-muted); margin: 15px 0;">View list of all
                            registered customers and manage staff account roles.</p>
                        <button onclick="window.location.href='admin-users.html'" class="normal"
                            style="width:100%; border-radius:12px;">Manage Users</button>
                    </div>
                </div>

                <!-- Recent Transactions - Full Width Row -->
                <div class="dashboard-grid-1" style="margin-bottom: 30px;">
                    <div class="data-card dash-card">
                        <div class="card-header">
                            <h3><i class="fas fa-history"></i> Recent Transactions</h3>
                        </div>
                        <div class="table-responsive">
                            <table id="admin-recent-order-table">
                                <thead>
                                    <tr>
                                        <th>Ref</th>
                                        <th>Client</th>
                                        <th>Value</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Inventory Velocity - Full Width Row -->
                <div class="dashboard-grid-1" style="margin-bottom: 30px;">
                    <div class="data-card dash-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> Inventory Velocity</h3>
                        </div>
                        <div class="inventory-performance-viz">
                            <div class="chart-mock">
                                <div class="bar" style="height: 80%;" data-label="Tops"></div>
                                <div class="bar" style="height: 45%;" data-label="Bottoms"></div>
                                <div class="bar" style="height: 95%;" data-label="Dresses"></div>
                                <div class="bar" style="height: 60%;" data-label="Heritage"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loyalty Program Section (Personal) -->
            <div class="dash-card loyalty-card fade-in">
                <div class="loyalty-content">
                    <div class="loyalty-icon"><i class="fas fa-crown"></i></div>
                    <div class="loyalty-text">
                        <h3>Alina Insider Rewards</h3>
                        <p>You're earning 1 point for every NPR 100 spent. Redeem points for exclusive discounts!</p>
                        <div class="progress-container">
                            <div class="progress-bar" id="points-progress" style="width: 0%;"></div>
                        </div>
                        <span id="points-needed">Spend NPR 500 more to reach Silver tier</span>
                    </div>
                    <button class="normal gold-btn" onclick="showToast('Feature coming soon!!!')">Redeem Points</button>
                </div>
            </div>

            <!-- 2. Settings Section (Account Setting) -->
            <div id="settings-section" class="section-wrapper">
                <div class="dash-card advanced-settings">
                    <div class="settings-header">
                        <h3><i class="fa-solid fa-user-gear"></i> Personal Configuration</h3>
                        <p>Keep your profile up to date for a better shopping experience.</p>
                    </div>

                    <form id="profile-form">
                        <div class="settings-grid">
                            <!-- Personal Details -->
                            <div class="settings-section">
                                <h4 class="section-title">Identity</h4>
                                <div class="input-group">
                                    <label>Full Name</label>
                                    <div class="input-wrapper">
                                        <i class="fa-solid fa-signature"></i>
                                        <input type="text" id="set-name" placeholder="Enter your full name">
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Email Address</label>
                                    <div class="input-wrapper disabled">
                                        <i class="fa-solid fa-envelope"></i>
                                        <input type="email" id="set-email" disabled>
                                        <i class="fa-solid fa-lock lock-icon"></i>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Phone Number</label>
                                    <div class="input-wrapper">
                                        <i class="fa-solid fa-phone"></i>
                                        <input type="tel" id="set-phone" placeholder="Enter phone number">
                                    </div>
                                </div>
                                <div class="input-row">
                                    <div class="input-group">
                                        <label>Date of Birth</label>
                                        <div class="input-wrapper">
                                            <i class="fa-solid fa-calendar"></i>
                                            <input type="date" id="set-dob">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Address Information -->
                            <div class="settings-section">
                                <h4 class="section-title">Delivery Address</h4>
                                <div class="input-row">
                                    <div class="input-group" style="flex: 2;">
                                        <label>Municipality</label>
                                        <div class="input-wrapper">
                                            <i class="fa-solid fa-building"></i>
                                            <input type="text" id="set-municipality" placeholder="Municipality Name">
                                        </div>
                                    </div>
                                    <div class="input-group" style="flex: 1;">
                                        <label>Ward No.</label>
                                        <div class="input-wrapper">
                                            <i class="fa-solid fa-map-pin"></i>
                                            <input type="number" id="set-ward" placeholder="Ward No.">
                                        </div>
                                    </div>
                                </div>
                                <div class="input-row">
                                    <div class="input-group">
                                        <label>Street Address</label>
                                        <div class="input-wrapper">
                                            <i class="fa-solid fa-road"></i>
                                            <input type="text" id="set-address" placeholder="e.g. Main Street, Tole">
                                        </div>
                                    </div>
                                </div>
                                <div class="input-row">
                                    <div class="input-group">
                                        <label>District</label>
                                        <div class="input-wrapper">
                                            <i class="fa-solid fa-map-location-dot"></i>
                                            <input type="text" id="set-district" placeholder="e.g. Kathmandu">
                                        </div>
                                    </div>
                                    <div class="input-group">
                                        <label>Province / State</label>
                                        <div class="input-wrapper">
                                            <i class="fa-solid fa-map"></i>
                                            <input type="text" id="set-province" placeholder="e.g. Bagmati">
                                        </div>
                                    </div>
                                </div>
                                <div class="input-row">
                                    <div class="input-group">
                                        <label>Country</label>
                                        <div class="input-wrapper">
                                            <i class="fa-solid fa-earth-americas"></i>
                                            <select id="set-country">
                                                <option value="Nepal">Nepal</option>
                                                <option value="India">India</option>
                                                <option value="USA">USA</option>
                                                <option value="UK">UK</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions-modern">
                            <button type="submit" class="normal btn-save-modern">
                                <span>Save Changes</span>
                                <i class="fa-solid fa-check"></i>
                            </button>
                        </div>
                    </form>

                    <!-- Danger Zone: Account Deletion -->
                    <div class="danger-zone">
                        <div class="danger-zone-header">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                            <h4>Danger Zone</h4>
                        </div>
                        <div class="danger-zone-content">
                            <div class="danger-info">
                                <h5>Delete Account</h5>
                                <p>Permanently delete your account and all associated data. This action cannot be undone.</p>
                            </div>
                            <button type="button" class="btn-delete-account" onclick="showDeleteAccountModal()">
                                <i class="fa-solid fa-trash-can"></i>
                                Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Purchase History -->
            <div id="orders-section" class="section-wrapper">
                <div class="dash-card">
                    <div class="dash-header-modern">
                        <h3><i class="fa-solid fa-clock-rotate-left"></i> Purchase History</h3>
                        <p>Track and manage your recent orders.</p>
                    </div>
                    <div class="table-responsive">
                        <table class="order-table-modern" id="user-order-table">
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>Date</th>
                                    <th>Products</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Dashboard Overview Sections - Row 1: Orders & Cart -->
            <div class="dashboard-grid-2">
                <div id="orders-section-mini" class="section-wrapper-mini">
                    <div class="dash-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-receipt"></i> My Orders</h3>
                            <a href="my-orders.html" class="view-link">View All Orders</a>
                        </div>
                        <div class="mini-list" id="mini-orders-list">
                            <p style="padding: 10px; color: #999; font-size: 13px;">No recent orders.</p>
                        </div>
                    </div>
                </div>
                <div id="cart-section" class="section-wrapper-mini">
                    <div class="dash-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-cart-shopping"></i> My Cart</h3>
                            <a href="cart.html" class="view-link">View Full Cart</a>
                        </div>
                        <div class="mini-list" id="mini-cart-list">
                            <p style="padding: 10px; color: #999; font-size: 13px;">Your cart is empty.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Overview Sections - Row 2: Wishlist & Cancellations -->
            <div class="dashboard-grid-2">
                <div id="wishlist-section" class="section-wrapper-mini">
                    <div class="dash-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-heart"></i> My Wishlist</h3>
                            <a href="wishlist.html" class="view-link">View All</a>
                        </div>
                        <div class="mini-list" id="mini-wishlist-list">
                            <p style="padding: 10px; color: #999; font-size: 13px;">Your wishlist is empty.</p>
                        </div>
                    </div>
                </div>
                <div id="cancellations-section" class="section-wrapper-mini">
                    <div class="dash-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-times-circle"></i> My Cancellations</h3>
                            <a href="my-cancellations.html" class="view-link">View All</a>
                        </div>
                        <div class="mini-list" id="mini-cancellations-list">
                            <p style="padding: 10px; color: #999; font-size: 13px;">No cancellations.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Overview Sections - Row 3: Track Order (Full Width) -->
            <div class="dashboard-grid-1">
                <div id="track-section" class="section-wrapper-mini">
                    <div class="dash-card">
                        <div class="dash-header-modern">
                            <h3><i class="fa-solid fa-truck-fast"></i> Track Order</h3>
                        </div>
                        <div class="track-box">
                            <p>Enter your Order ID to see real-time status.</p>
                            <div class="track-input-group">
                                <input type="text" id="track-id-input" placeholder="e.g. #1001">
                                <button onclick="trackOrder()"><i class="fa-solid fa-magnifying-glass"></i></button>
                            </div>
                            <div id="track-result" class="track-result"></div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <footer></footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user) { window.location.href = 'login.html'; return; }

            // SOVEREIGN ADMIN INTEGRATION
            if (user.role === 'admin') {
                document.getElementById('sovereign-suite').style.display = 'block';
                renderAdminDashboard();
            }

            // Initial greeting & UI
            document.getElementById('user-greeting-large').innerText = `Hello, ${user.name}!`;
            document.getElementById('user-email-small').innerText = user.email;
            const roleBadge = document.getElementById('user-role-badge');
            if (user.role === 'admin') {
                roleBadge.innerHTML = `<i class="fa-solid fa-user-shield"></i> Sovereign Admin`;
                roleBadge.className = 'role-badge role-admin';
            } else {
                roleBadge.innerHTML = `<i class="fa-solid fa-user"></i> User`;
                roleBadge.className = 'role-badge role-user';
            }

            if (user.profilePic) document.getElementById('avatar-preview').innerHTML = `<img src="${user.profilePic}" alt="Profile">`;

            // Fill form
            if (document.getElementById('set-name')) document.getElementById('set-name').value = user.name || "";
            if (document.getElementById('set-email')) document.getElementById('set-email').value = user.email || "";
            if (document.getElementById('set-phone')) document.getElementById('set-phone').value = user.phone || "";
            if (document.getElementById('set-dob')) document.getElementById('set-dob').value = user.dob || "";
            if (document.getElementById('set-municipality')) document.getElementById('set-municipality').value = user.municipality || "";
            if (document.getElementById('set-ward')) document.getElementById('set-ward').value = user.ward || "";
            if (document.getElementById('set-address')) document.getElementById('set-address').value = user.address || "";
            if (document.getElementById('set-district')) document.getElementById('set-district').value = user.district || "";
            if (document.getElementById('set-province')) document.getElementById('set-province').value = user.province || "";
            if (document.getElementById('set-country')) document.getElementById('set-country').value = user.country || "Nepal";

            // Form Submission
            document.getElementById('profile-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const updatedUser = {
                    ...user,
                    name: document.getElementById('set-name').value,
                    phone: document.getElementById('set-phone').value,
                    dob: document.getElementById('set-dob').value,
                    municipality: document.getElementById('set-municipality').value,
                    ward: document.getElementById('set-ward').value,
                    address: document.getElementById('set-address').value,
                    district: document.getElementById('set-district').value,
                    province: document.getElementById('set-province').value,
                    country: document.getElementById('set-country').value
                };
                localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                let allUsers = JSON.parse(localStorage.getItem('users')) || [];
                const uIdx = allUsers.findIndex(u => u.email === updatedUser.email);
                if (uIdx !== -1) { allUsers[uIdx] = updatedUser; localStorage.setItem('users', JSON.stringify(allUsers)); }
                showToast('Configuration Saved');
                document.getElementById('user-greeting-large').innerText = `Hello, ${updatedUser.name}!`;
            });

            // Avatar Upload - Auto-save with visual feedback
            document.getElementById('profile-upload').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        showToast('Please select an image file');
                        return;
                    }
                    
                    // Validate file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showToast('Image size must be less than 5MB');
                        return;
                    }
                    
                    // Show uploading state
                    const avatarPreview = document.getElementById('avatar-preview');
                    avatarPreview.style.opacity = '0.5';
                    avatarPreview.style.filter = 'blur(2px)';
                    showToast('Uploading profile picture...');
                    
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const dataUrl = event.target.result;
                        
                        // Update preview with smooth transition
                        setTimeout(() => {
                            avatarPreview.innerHTML = `<img src="${dataUrl}" alt="Profile Picture">`;
                            avatarPreview.style.opacity = '1';
                            avatarPreview.style.filter = 'none';
                            
                            // Auto-save to localStorage
                            const cUser = JSON.parse(localStorage.getItem('currentUser'));
                            cUser.profilePic = dataUrl;
                            localStorage.setItem('currentUser', JSON.stringify(cUser));
                            
                            // Update in users array
                            let aUsers = JSON.parse(localStorage.getItem('users')) || [];
                            const idx = aUsers.findIndex(u => u.email === cUser.email);
                            if (idx !== -1) {
                                aUsers[idx].profilePic = dataUrl;
                                localStorage.setItem('users', JSON.stringify(aUsers));
                            }
                            
                            // Show success message
                            showToast('✓ Profile picture saved successfully!');
                            
                            // Add success animation
                            avatarPreview.style.transform = 'scale(1.05)';
                            setTimeout(() => {
                                avatarPreview.style.transform = 'scale(1)';
                            }, 300);
                        }, 300);
                    };
                    
                    reader.onerror = function() {
                        avatarPreview.style.opacity = '1';
                        avatarPreview.style.filter = 'none';
                        showToast('Error uploading image. Please try again.');
                    };
                    
                    reader.readAsDataURL(file);
                }
            });

            renderUserOrders(user.email);
            renderDashboardCart();
            renderDashboardWishlist();
            renderDashboardOrders(user.email);
            renderDashboardCancellations(user.email);

            // Update Stats
            const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
            const userOrders = allOrders.filter(o => o.userEmail === user.email);
            const wishlistCount = JSON.parse(localStorage.getItem('wishlist'))?.length || 0;
            const totalSpent = userOrders.reduce((sum, o) => sum + o.total, 0);
            document.getElementById('count-orders').innerText = userOrders.length;
            document.getElementById('count-wishlist').innerText = wishlistCount;
            document.getElementById('count-spent').innerText = `NPR ${totalSpent}`;
            const points = Math.floor(totalSpent / 100);
            document.getElementById('loyalty-points').innerText = points;
            document.getElementById('points-progress').style.width = ((points % 500) / 5) + "%";
            document.getElementById('points-needed').innerText = `Earn ${500 - (points % 500)} more points for next tier!`;
        });

        function renderDashboardCart() {
            const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
            const container = document.getElementById('mini-cart-list');
            if (!container) return;

            if (cartItems.length === 0) {
                container.innerHTML = '<p style="padding: 10px; color: #999; font-size: 13px;">Your cart is empty.</p>';
                return;
            }

            container.innerHTML = cartItems.slice(0, 3).map(item => `
                                          <div class="mini-item">
                                              <img src="${item.image || 'image/product/f1.jpg'}" alt="${item.name}" onerror="this.onerror=null;this.src='image/product/f1.jpg';">
                                              <div class="mini-item-info">
                                                  <h4>${item.name}</h4>
                                                  <p>${item.quantity} x NPR ${item.price}</p>
                                              </div>
                                          </div>
                                      `).join('');
            if (cartItems.length > 3) {
                container.innerHTML += `<p style="font-size: 11px; margin-top: 10px; color: var(--primary-color);">+ ${cartItems.length - 3} more items</p>`;
            }
        }

        function renderDashboardWishlist() {
            const wishlistIds = JSON.parse(localStorage.getItem('wishlist')) || [];
            const container = document.getElementById('mini-wishlist-list');
            if (!container) return;

            if (wishlistIds.length === 0) {
                container.innerHTML = '<p style="padding: 10px; color: #999; font-size: 13px;">Your wishlist is empty.</p>';
                return;
            }

            const allProducts = JSON.parse(localStorage.getItem('products')) || [];
            const wishlistItems = wishlistIds.map(id => allProducts.find(p => p.id === id)).filter(p => p);

            container.innerHTML = wishlistItems.slice(0, 3).map(item => `
                                          <div class="mini-item">
                                              <img src="${item.image || 'image/product/f1.jpg'}" alt="${item.name}" onerror="this.onerror=null;this.src='image/product/f1.jpg';">
                                              <div class="mini-item-info">
                                                  <h4>${item.name}</h4>
                                                  <p>${item.brand}</p>
                                              </div>
                                          </div>
                                      `).join('');
            if (wishlistItems.length > 3) {
                container.innerHTML += `<p style="font-size: 11px; margin-top: 10px; color: var(--primary-color);">+ ${wishlistItems.length - 3} more items</p>`;
            }
        }

        function trackOrder() {
            const trackId = document.getElementById('track-id-input').value.trim().replace('#', '');
            const resultArea = document.getElementById('track-result');
            const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
            const order = allOrders.find(o => o.id.toString() === trackId);

            if (!order) {
                resultArea.innerHTML = '<p style="color: #ef4444; font-size: 13px; margin-top: 15px;">Order ID not found.</p>';
                return;
            }

            const steps = ['placed', 'shipped', 'completed'];
            const currentIdx = steps.indexOf(order.status.toLowerCase());

            resultArea.innerHTML = `
                                          <div class="tracking-visual">
                                              <div class="track-step ${currentIdx >= 0 ? 'active' : ''}">Placed</div>
                                              <div class="track-step ${currentIdx >= 1 ? 'active' : ''}">Shipped</div>
                                              <div class="track-step ${currentIdx >= 2 ? 'active' : ''}">Delivered</div>
                                          </div>
                                          <p style="font-size: 13px; margin-top: 15px; font-weight: 600;">Status: ${order.status.toUpperCase()}</p>
                                      `;
        }

        function renderUserOrders(userEmail) {
            const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
            const userOrders = allOrders.filter(o => o.userEmail === userEmail);
            const tableBody = document.querySelector('#user-order-table tbody');

            if (userOrders.length === 0) {
                if (tableBody) tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 40px; color: #999;">You haven\'t placed any orders yet.</td></tr>';
                return;
            }

            tableBody.innerHTML = userOrders.map(o => `
                                          <tr>
                                              <td data-label="REFERENCE"><strong>#${o.id}</strong></td>
                                              <td data-label="DATE">${o.date}</td>
                                              <td data-label="PRODUCTS">${o.items.length} Product(s)</td>
                                              <td data-label="AMOUNT"><span class="price-text">NPR ${o.total}</span></td>
                                              <td data-label="STATUS"><span class="status-badge status-${o.status}">${o.status}</span></td>
                                          </tr>
                                      `).join('');
        }

        function renderDashboardOrders(userEmail) {
            const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
            const userOrders = allOrders.filter(o => o.userEmail === userEmail);
            const container = document.getElementById('mini-orders-list');
            if (!container) return;

            if (userOrders.length === 0) {
                container.innerHTML = '<p style="padding: 10px; color: #999; font-size: 13px;">No recent orders.</p>';
                return;
            }

            const allProducts = JSON.parse(localStorage.getItem('products')) || [];
            container.innerHTML = userOrders.slice(0, 3).map(order => {
                const firstProduct = allProducts.find(p => p.id === order.items[0]?.id);
                return `
                                              <div class="mini-item">
                                                  <img src="${firstProduct?.image || 'image/product/f1.jpg'}" alt="Order #${order.id}" onerror="this.onerror=null;this.src='image/product/f1.jpg';">
                                                  <div class="mini-item-info">
                                                      <h4>Order #${order.id}</h4>
                                                      <p>${order.items.length} item(s) • NPR ${order.total}</p>
                                                  </div>
                                              </div>
                                          `;
            }).join('');
            if (userOrders.length > 3) {
                container.innerHTML += `<p style="font-size: 11px; margin-top: 10px; color: var(--primary-color);">+ ${userOrders.length - 3} more orders</p>`;
            }
        }

        function renderDashboardCancellations(userEmail) {
            const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
            const cancelledOrders = allOrders.filter(o => o.userEmail === userEmail && o.status === 'cancelled');
            const container = document.getElementById('mini-cancellations-list');
            if (!container) return;

            if (cancelledOrders.length === 0) {
                container.innerHTML = '<p style="padding: 10px; color: #999; font-size: 13px;">No cancellations.</p>';
                return;
            }

            const allProducts = JSON.parse(localStorage.getItem('products')) || [];
            container.innerHTML = cancelledOrders.slice(0, 3).map(order => {
                const firstProduct = allProducts.find(p => p.id === order.items[0]?.id);
                return `
                                              <div class="mini-item" style="opacity: 0.7;">
                                                  <img src="${firstProduct?.image || 'image/product/f1.jpg'}" alt="Cancelled Order #${order.id}" onerror="this.onerror=null;this.src='image/product/f1.jpg';" style="filter: grayscale(100%);">
                                                  <div class="mini-item-info">
                                                      <h4>Order #${order.id}</h4>
                                                      <p>Cancelled • NPR ${order.total}</p>
                                                  </div>
                                              </div>
                                          `;
            }).join('');
            if (cancelledOrders.length > 3) {
                container.innerHTML += `<p style="font-size: 11px; margin-top: 10px; color: var(--primary-color);">+ ${cancelledOrders.length - 3} more cancellations</p>`;
            }
        }
    </script>
</body>

</html>